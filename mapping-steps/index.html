
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Convert-Pheno Toolkit Documentation" name="description"/>
<meta content="Manuel Rueda, PhD" name="author"/>
<link href="../implementation/" rel="prev"/>
<link href="../omop2bff/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.20" name="generator"/>
<title>üîç Mapping Steps - Convert-Pheno Documentation</title>
<link href="../assets/stylesheets/main.e53b48f4.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../css/theme_overrides.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="amber" data-md-color-primary="blue-grey" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#step-1-conversion-to-the-target-model">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Convert-Pheno Documentation" class="md-header__button md-logo" data-md-component="logo" href=".." title="Convert-Pheno Documentation">
<img alt="logo" src="../img/CP-logo-grey.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Convert-Pheno Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              üîç Mapping Steps
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="amber" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue-grey" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="amber" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="blue-grey" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/mrueda/convert-pheno" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"></path></svg>
</div>
<div class="md-source__repository">
    Convert-Pheno
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Convert-Pheno Documentation" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Convert-Pheno Documentation">
<img alt="logo" src="../img/CP-logo-grey.png"/>
</a>
    Convert-Pheno Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/mrueda/convert-pheno" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"></path></svg>
</div>
<div class="md-source__repository">
    Convert-Pheno
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
<span class="md-ellipsis">
    üè† Introduction
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            üè† Introduction
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../what-is-convert-pheno/">
<span class="md-ellipsis">
    ‚ùì What is Convert-Pheno?
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../supported-formats/">
<span class="md-ellipsis">
    üìÇ Supported formats
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../download-and-installation/">
<span class="md-ellipsis">
    ‚¨áÔ∏è Download &amp; Installation
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-ellipsis">
    üõ† Use
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            üõ† Use
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../use-as-a-command-line-interface/">
<span class="md-ellipsis">
    üíª As a command-line interface
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../use-as-a-module/">
<span class="md-ellipsis">
    üì¶ As a module
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../use-as-an-api/">
<span class="md-ellipsis">
    üîó As an API
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://cnag-biomedical-informatics.github.io/convert-pheno-ui/">
<span class="md-ellipsis">
    üåê Web App User Interface
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    üîÑ Formats Accepted
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            üîÑ Formats Accepted
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../bff/">
<span class="md-ellipsis">
    üß¨ Beacon v2 Models (BFF)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../pxf/">
<span class="md-ellipsis">
    üì¶ Phenopackets v2 (PXF)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../redcap/">
<span class="md-ellipsis">
    üìù REDCap
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../omop-cdm/">
<span class="md-ellipsis">
    üè• OMOP‚ÄëCDM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cdisc-odm/">
<span class="md-ellipsis">
    üìë CDISC‚ÄëODM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../csv/">
<span class="md-ellipsis">
    üìä CSV
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
<span class="md-ellipsis">
    ‚öôÔ∏è Technical Details
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            ‚öôÔ∏è Technical Details
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../implementation/">
<span class="md-ellipsis">
    üèó Implementation
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    üîç Mapping Steps
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    üîç Mapping Steps
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-1-conversion-to-the-target-model">
<span class="md-ellipsis">
      Step 1: Conversion to the target model
    </span>
</a>
<nav aria-label="Step 1: Conversion to the target model" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#schema-mapping">
<span class="md-ellipsis">
      Schema mapping
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#from-table-mappings-to-code">
<span class="md-ellipsis">
      From table mappings to code
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lossless-or-lossy-conversion">
<span class="md-ellipsis">
      Lossless or lossy conversion?
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#preservation-and-augmentation-of-ontologies">
<span class="md-ellipsis">
      Preservation and augmentation of ontologies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#similarity-threshold">
<span class="md-ellipsis">
      üí° Similarity Threshold
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-note">
<span class="md-ellipsis">
      ‚ö†Ô∏è Performance Note
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-results-table">
<span class="md-ellipsis">
      üß™ Example Results Table
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-2-conversion-to-the-final-model">
<span class="md-ellipsis">
      Step 2: Conversion to the final model
    </span>
</a>
<nav aria-label="Step 2: Conversion to the final model" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#to-phenopackets">
<span class="md-ellipsis">
      To Phenopackets
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#to-omop-cdm">
<span class="md-ellipsis">
      To OMOP CDM
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
<span class="md-ellipsis">
    üìä Mapping Tables
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
            üìä Mapping Tables
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../omop2bff/">
<span class="md-ellipsis">
    üîÑ OMOP to BFF
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../pxf2bff/">
<span class="md-ellipsis">
    üîÑ PXF to BFF
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../bff2pxf/">
<span class="md-ellipsis">
    üîÑ BFF to PXF
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
<span class="md-ellipsis">
    ‚ùì Help
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            ‚ùì Help
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../tutorial/">
<span class="md-ellipsis">
    üéì Tutorial
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://colab.research.google.com/drive/1T6F3bLwfZyiYKD6fl1CIxs9vG068RHQ6">
<span class="md-ellipsis">
    üìñ Google Colab
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../usage/">
<span class="md-ellipsis">
    üõ† Usage
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../faq/">
<span class="md-ellipsis">
    ü§î FAQs
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../future-plans/">
<span class="md-ellipsis">
    üîÆ Future Plans
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
<span class="md-ellipsis">
    ‚ÑπÔ∏è About
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            ‚ÑπÔ∏è About
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../about/">
<span class="md-ellipsis">
    üìÑ About
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../citation/">
<span class="md-ellipsis">
    üìñ Citation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>üîç Mapping Steps</h1>
<h2 id="step-1-conversion-to-the-target-model">Step 1: Conversion to the target model<a class="headerlink" href="#step-1-conversion-to-the-target-model" title="Permanent link">¬∂</a></h2>
<p>Internally, all models are mapped to the <a href="../bff/">Beacon v2 Models</a>.</p>
<div class="mermaid">%%{init: {'theme':'neutral'}}%%
graph LR
  subgraph "Step 1:Conversion to BFF"
  B[Phenopackets v2] --&gt;|pxf2bff| A
  C[REDCap] --&gt;|redcap2bff| A[Beacon v2 Models]
  D[OMOP-CDM] --&gt;|omop2bff| A
  E[CDISC-ODM] --&gt;|cdisc2bff| A
  G[CSV] --&gt;|csv2bff| A
  end

  subgraph "Step 2:BFF to Final"
  A --&gt; |bff2pxf | F[Phenopackets v2]
  A --&gt; |bff2omop| H[OMOP-CDM]
  end

  style A fill: #6495ED, stroke: #6495ED
  style B fill: #FF7F50, stroke: #FF7F50
  style C fill: #FF6965, stroke: #FF6965
  style D fill: #3CB371, stroke: #3CB371
  style E fill: #DDA0DD, stroke: #DDA0DD
  style F fill: #FF7F50, stroke: #FF7F50
  style G fill: #FFFF00, stroke: #FFFF00
  style H fill: #3CB371, stroke: #3CB371

</div>
<figcaption>Convert-Pheno internal mapping steps</figcaption>
<details class="question">
<summary>Why use Beacon v2 as the target model?</summary>
<ul>
<li><strong>JSON Schema Utilization:</strong> Beacon v2 employs <a href="https://github.com/ga4gh-beacon/beacon-v2/tree/main/models">JSON Schema</a> for model content definition, facilitating transparency and accessibility in a collaborative environment compared to Phenopackets' Protobuf usage.</li>
<li><strong>Accommodation of Additional Properties:</strong> The Beacon v2 Models schema permits additional properties, enhancing adaptability and enabling near-lossless conversion, especially when using JSON in non-relational databases.</li>
<li><strong>Beacon v2 API Compatibility:</strong> The BFF is directly compatible with the Beacon v2 API ecosystem, a feature not available in Phenopackets without additional mapping.</li>
<li><strong>Expansion Possibility:</strong> Being based at CNAG, a genomics institution, the potential to extend Convert-Pheno's mapping to encompass other Beacon v2 entities was a significant consideration.</li>
<li><strong>Overlap with Phenopackets v2:</strong> Despite minor differences in nomenclature or hierarchy, many essential terms remain identical, encouraging interoperability.</li>
</ul>
</details>
<h3 id="schema-mapping">Schema mapping<a class="headerlink" href="#schema-mapping" title="Permanent link">¬∂</a></h3>
<p>When starting a new conversion between two data models, the first step is to <strong>map variables</strong> between the two data schemas. At the time of writting this (Sep-2023) the mapping of variables is still performed <strong>manually</strong> by human brains <img alt="üò∞" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f630.svg" title=":cold_sweat:">.</img></p>
<details class="info">
<summary>Mapping strategy: External or hardcoded?</summary>
<p>In the early stages of development, we explored the possibility of employing configuration files to guide the mapping process as an alternative to hardcoded solutions. However, JSON data structures' complexity, mainly due to nesting, made this approach impractical for most scenarios, except for <a href="../redcap/">REDCap</a> and <a href="../cdisc-odm/">CDISC-ODM</a> data, which are mapped to Beacon v2 Models via configuration files.</p>
</details>
<p>In the <strong>Mapping tables</strong> section (accessible via the 'Technical Details' tab on the left navigation bar), we outline the equivalencies between different schemas. These tables fulfill several purposes:</p>
<ol>
<li>It's a quick way to help out the <em>Health Data</em> community.</li>
<li>Experts can check it out and suggest changes without digging into all the code.</li>
<li>If you want to chip in and create a new conversion, you can start by making a mapping table.</li>
</ol>
<div class="admonition bug">
<p class="admonition-title">Notice</p>
<p>Please note that accurately mapping, even between two standards, is a substantial undertaking. While we possess expertise in certain areas, we certainly don't claim mastery in all <img alt="üôè" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f64f.svg" title=":pray:">. We sincerely welcome any <strong>suggestions</strong> or feedback.</img></p>
</div>
<details class="info">
<summary>Contributing</summary>
<p>While creating the code for a new format can be challenging, modifying properties in an existing one is much easier. Feel free to <a href="https://github.com/CNAG-Biomedical-Informatics/convert-pheno/issues">reach us</a> should you plan to contribute.</p>
</details>
<h3 id="from-table-mappings-to-code">From table mappings to code<a class="headerlink" href="#from-table-mappings-to-code" title="Permanent link">¬∂</a></h3>
<p>These tables serve as a <strong>reference</strong> for implementing Convert-Pheno's source code. Each format conversion has a dedicated Perl <a href="https://github.com/CNAG-Biomedical-Informatics/convert-pheno/tree/main/lib/Convert/Pheno">submodule</a>, and during implementation we verify that the converted output conforms to the final target data schema.</p>
<h3 id="lossless-or-lossy-conversion">Lossless or lossy conversion?<a class="headerlink" href="#lossless-or-lossy-conversion" title="Permanent link">¬∂</a></h3>
<p>When converting data from one data standard to another, it is important to consider the possibility of losing information due to differences in schema and field mapping. To mitigate this, we aimed for a <strong>lossless</strong> conversion by incorporating non-mappable variables as <code>additionalProperties</code> within the Beacon v2 Models <a href="https://docs.genomebeacons.org/schemas-md/individuals_defaultSchema/">schema</a>. This allows users to access the original variables and their values through database queries, especially when using non-relational databases like MongoDB. </p>
<p>During the conversion process, handling variables that cannot be directly mapped can result in one of two scenarios:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">Unmappable variables</label><label for="__tabbed_1_2">Match to a different entity</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Often, the input data model has variables that do not directly map to the target but are still useful to retain in the output format. If the target format allows for extra properties in a given term (as BFF does), these original variables are stored under the <code>_info</code> property (or <code>_</code> + ‚Äòproperty name‚Äô). This commonly happens in conversions from OMOP CDM to BFF. </p>
<p>Example extracted from <code>omop2bff</code> <a href="https://github.com/CNAG-Biomedical-Informatics/convert-pheno/blob/main/t/omop2bff/out/individuals.json">conversion</a>:</p>
<details class="example">
<summary>See example</summary>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nt">"interventionsOrProcedures"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">       </span><span class="p">{</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">          </span><span class="nt">"_info"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">             </span><span class="nt">"PROCEDURE_OCCURRENCE"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">                </span><span class="nt">"OMOP_columns"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">                   </span><span class="nt">"modifier_concept_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">                   </span><span class="nt">"modifier_source_value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">                   </span><span class="nt">"person_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">                   </span><span class="nt">"procedure_concept_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4163872</span><span class="p">,</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">                   </span><span class="nt">"procedure_date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1955-10-22"</span><span class="p">,</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">                   </span><span class="nt">"procedure_datetime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1955-10-22 00:00:00"</span><span class="p">,</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">                   </span><span class="nt">"procedure_occurrence_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">                   </span><span class="nt">"procedure_source_concept_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4163872</span><span class="p">,</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">                   </span><span class="nt">"procedure_source_value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">399208008</span><span class="p">,</span>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">                   </span><span class="nt">"procedure_type_concept_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">38000275</span><span class="p">,</span>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">                   </span><span class="nt">"provider_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"\\N"</span><span class="p">,</span>
</span><span id="__span-0-17"><a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">                   </span><span class="nt">"quantity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"\\N"</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-0-18"><a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">                   </span><span class="nt">"visit_detail_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-0-19"><a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">                   </span><span class="nt">"visit_occurrence_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">103</span>
</span><span id="__span-0-20"><a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-0-21"><a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">             </span><span class="p">}</span>
</span><span id="__span-0-22"><a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-0-23"><a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">          </span><span class="nt">"ageAtProcedure"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-24"><a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">             </span><span class="nt">"age"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-25"><a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">                </span><span class="nt">"iso8601duration"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"35Y"</span>
</span><span id="__span-0-26"><a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">             </span><span class="p">}</span>
</span><span id="__span-0-27"><a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-0-28"><a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">          </span><span class="nt">"dateOfProcedure"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1955-10-22"</span><span class="p">,</span>
</span><span id="__span-0-29"><a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">          </span><span class="nt">"procedureCode"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-30"><a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">             </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"SNOMED:399208008"</span><span class="p">,</span>
</span><span id="__span-0-31"><a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">             </span><span class="nt">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Plain chest X-ray"</span>
</span><span id="__span-0-32"><a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-0-33"><a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">       </span><span class="p">}</span>
</span><span id="__span-0-34"><a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w"> </span><span class="p">]</span>
</span></code></pre></div>
</details>
<p>Example extracted from <code>redcap2bff</code> <a href="https://github.com/CNAG-Biomedical-Informatics/convert-pheno/blob/main/t/redcap2bff/out/individuals.json">conversion</a>:</p>
<details class="example">
<summary>See example</summary>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nt">"treatments"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">       </span><span class="p">{</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">          </span><span class="nt">"_info"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">             </span><span class="nt">"dose"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">             </span><span class="nt">"drug"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"budesonide"</span><span class="p">,</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">             </span><span class="nt">"drug_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"budesonide"</span><span class="p">,</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">             </span><span class="nt">"duration"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">             </span><span class="nt">"field"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"budesonide_oral_status"</span><span class="p">,</span>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">             </span><span class="nt">"route"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"oral"</span><span class="p">,</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">             </span><span class="nt">"start"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">             </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"never treated"</span><span class="p">,</span>
</span><span id="__span-1-12"><a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">             </span><span class="nt">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-1-13"><a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-1-14"><a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">          </span><span class="nt">"doseIntervals"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-1-15"><a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">          </span><span class="nt">"routeOfAdministration"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-16"><a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">             </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"NCIT:C38288"</span><span class="p">,</span>
</span><span id="__span-1-17"><a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">             </span><span class="nt">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Oral Route of Administration"</span>
</span><span id="__span-1-18"><a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-1-19"><a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">          </span><span class="nt">"treatmentCode"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-20"><a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">             </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"NCIT:C1027"</span><span class="p">,</span>
</span><span id="__span-1-21"><a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">             </span><span class="nt">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Budesonide"</span>
</span><span id="__span-1-22"><a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-1-23"><a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">       </span><span class="p">}</span>
</span><span id="__span-1-24"><a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="p">]</span>
</span></code></pre></div>
</details>
<p>Example of longitudinal data stored under <code>_visit</code> in a <code>omop2bff</code> <a href="https://github.com/CNAG-Biomedical-Informatics/convert-pheno/blob/main/t/omop2bff/out/individuals.json">conversion</a>:</p>
<details class="example">
<summary>See example</summary>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nt">"_visit"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">        </span><span class="nt">"_info"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">           </span><span class="nt">"VISIT_OCCURRENCE"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">              </span><span class="nt">"OMOP_columns"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">                 </span><span class="nt">"admitting_source_concept_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">                 </span><span class="nt">"admitting_source_value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">                 </span><span class="nt">"care_site_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"\\N"</span><span class="p">,</span>
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">                 </span><span class="nt">"discharge_to_concept_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">                 </span><span class="nt">"discharge_to_source_value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-2-10"><a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">                 </span><span class="nt">"person_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-2-11"><a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">                 </span><span class="nt">"preceding_visit_occurrence_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">347</span><span class="p">,</span>
</span><span id="__span-2-12"><a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">                 </span><span class="nt">"provider_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"\\N"</span><span class="p">,</span>
</span><span id="__span-2-13"><a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">                 </span><span class="nt">"visit_concept_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">9201</span><span class="p">,</span>
</span><span id="__span-2-14"><a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">                 </span><span class="nt">"visit_end_date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1972-12-21"</span><span class="p">,</span>
</span><span id="__span-2-15"><a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">                 </span><span class="nt">"visit_end_datetime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1972-12-21 00:00:00"</span><span class="p">,</span>
</span><span id="__span-2-16"><a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">                 </span><span class="nt">"visit_occurrence_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">312</span><span class="p">,</span>
</span><span id="__span-2-17"><a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">                 </span><span class="nt">"visit_source_concept_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-2-18"><a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">                 </span><span class="nt">"visit_source_value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"5d035dd1-30d9-4389-b94c-64947bf1f18c"</span><span class="p">,</span>
</span><span id="__span-2-19"><a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">                 </span><span class="nt">"visit_start_date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1972-12-20"</span><span class="p">,</span>
</span><span id="__span-2-20"><a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">                 </span><span class="nt">"visit_start_datetime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1972-12-20 00:00:00"</span><span class="p">,</span>
</span><span id="__span-2-21"><a href="#__codelineno-2-21" id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">                 </span><span class="nt">"visit_type_concept_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">44818517</span>
</span><span id="__span-2-22"><a href="#__codelineno-2-22" id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-2-23"><a href="#__codelineno-2-23" id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">           </span><span class="p">}</span>
</span><span id="__span-2-24"><a href="#__codelineno-2-24" id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-2-25"><a href="#__codelineno-2-25" id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">        </span><span class="nt">"concept"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-26"><a href="#__codelineno-2-26" id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">           </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Visit:IP"</span><span class="p">,</span>
</span><span id="__span-2-27"><a href="#__codelineno-2-27" id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="w">           </span><span class="nt">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Inpatient Visit"</span>
</span><span id="__span-2-28"><a href="#__codelineno-2-28" id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-2-29"><a href="#__codelineno-2-29" id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="w">        </span><span class="nt">"end_date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1972-12-21T00:00:00Z"</span><span class="p">,</span>
</span><span id="__span-2-30"><a href="#__codelineno-2-30" id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="w">        </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"312"</span><span class="p">,</span>
</span><span id="__span-2-31"><a href="#__codelineno-2-31" id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="w">        </span><span class="nt">"occurrence_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">312</span><span class="p">,</span>
</span><span id="__span-2-32"><a href="#__codelineno-2-32" id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="w">        </span><span class="nt">"start_date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1972-12-20T00:00:00Z"</span><span class="p">,</span>
</span><span id="__span-2-33"><a href="#__codelineno-2-33" id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="w">        </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-34"><a href="#__codelineno-2-34" id="__codelineno-2-34" name="__codelineno-2-34"></a><span class="w">           </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Visit Type:OMOP4822465"</span><span class="p">,</span>
</span><span id="__span-2-35"><a href="#__codelineno-2-35" id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="w">           </span><span class="nt">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Visit derived from encounter on claim"</span>
</span><span id="__span-2-36"><a href="#__codelineno-2-36" id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-2-37"><a href="#__codelineno-2-37" id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="w">     </span><span class="p">},</span>
</span><span id="__span-2-38"><a href="#__codelineno-2-38" id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="w">     </span><span class="nt">"featureType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-39"><a href="#__codelineno-2-39" id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="w">        </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"SNOMED:428251008"</span><span class="p">,</span>
</span><span id="__span-2-40"><a href="#__codelineno-2-40" id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="w">        </span><span class="nt">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"History of appendectomy"</span>
</span><span id="__span-2-41"><a href="#__codelineno-2-41" id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="w">     </span><span class="p">},</span>
</span><span id="__span-2-42"><a href="#__codelineno-2-42" id="__codelineno-2-42" name="__codelineno-2-42"></a><span class="w">     </span><span class="nt">"onset"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-43"><a href="#__codelineno-2-43" id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="w">        </span><span class="nt">"iso8601duration"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"56Y"</span>
</span><span id="__span-2-44"><a href="#__codelineno-2-44" id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="w">     </span><span class="p">}</span>
</span><span id="__span-2-45"><a href="#__codelineno-2-45" id="__codelineno-2-45" name="__codelineno-2-45"></a><span class="p">}</span>
</span></code></pre></div>
</details>
</div>
<div class="tabbed-block">
<p>When a variable corresponds to other entities in <a href="https://github.com/ga4gh-beacon/beacon-v2">Beacon v2 Models</a>, it is stored within the <code>info</code> term of the <a href="https://docs.genomebeacons.org/schemas-md/individuals_defaultSchema/">individuals</a> entity. For instance, a <code>PXF</code> file may contain the <a href="https://phenopacket-schema.readthedocs.io/en/latest/phenopacket.html">biosamples</a> property, which doesn't find a direct match in the <a href="https://docs.genomebeacons.org/schemas-md/individuals_defaultSchema/">individuals</a> entity as it corresponds to the <a href="https://docs.genomebeacons.org/schemas-md/biosamples_defaultSchema/">biosamples</a> entity in Beacon v2 Models. To ensure the retention of this information, we place it under <code>info.phenopacket.biosamples</code>.</p>
<p>Example extracted from <code>pxf2bff</code> <a href="https://github.com/CNAG-Biomedical-Informatics/convert-pheno/blob/main/t/pxf2bff/out/individuals.json">conversion</a>:</p>
<details class="example">
<summary>See example</summary>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nt">"info"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">          </span><span class="nt">"phenopacket"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">             </span><span class="nt">"biosamples"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">                </span><span class="p">{</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">                   </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"biosample.1"</span><span class="p">,</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">                   </span><span class="nt">"phenotypicFeatures"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">                      </span><span class="p">{</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">                         </span><span class="nt">"excluded"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">                         </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">                            </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"HP:0003798"</span><span class="p">,</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">                            </span><span class="nt">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Nemaline bodies"</span>
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">                         </span><span class="p">}</span>
</span><span id="__span-3-13"><a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">                      </span><span class="p">}</span>
</span><span id="__span-3-14"><a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="w">                   </span><span class="p">],</span>
</span><span id="__span-3-15"><a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">                   </span><span class="nt">"procedure"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-16"><a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="w">                      </span><span class="nt">"bodySite"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-17"><a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">                         </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"UBERON:0002378"</span><span class="p">,</span>
</span><span id="__span-3-18"><a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">                         </span><span class="nt">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"muscle of abdomen"</span>
</span><span id="__span-3-19"><a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="w">                      </span><span class="p">},</span>
</span><span id="__span-3-20"><a href="#__codelineno-3-20" id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="w">                      </span><span class="nt">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-21"><a href="#__codelineno-3-21" id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="w">                         </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"NCIT:C51895"</span><span class="p">,</span>
</span><span id="__span-3-22"><a href="#__codelineno-3-22" id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="w">                         </span><span class="nt">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Muscle Biopsy"</span>
</span><span id="__span-3-23"><a href="#__codelineno-3-23" id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="w">                      </span><span class="p">},</span>
</span><span id="__span-3-24"><a href="#__codelineno-3-24" id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="w">                      </span><span class="nt">"performed"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-25"><a href="#__codelineno-3-25" id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="w">                         </span><span class="nt">"age"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-26"><a href="#__codelineno-3-26" id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="w">                            </span><span class="nt">"iso8601duration"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"P1D"</span>
</span><span id="__span-3-27"><a href="#__codelineno-3-27" id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="w">                         </span><span class="p">}</span>
</span><span id="__span-3-28"><a href="#__codelineno-3-28" id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="w">                      </span><span class="p">}</span>
</span><span id="__span-3-29"><a href="#__codelineno-3-29" id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="w">                   </span><span class="p">},</span>
</span><span id="__span-3-30"><a href="#__codelineno-3-30" id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="w">                   </span><span class="nt">"sampledTissue"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-31"><a href="#__codelineno-3-31" id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="w">                      </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"UBERON:0002378"</span><span class="p">,</span>
</span><span id="__span-3-32"><a href="#__codelineno-3-32" id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="w">                      </span><span class="nt">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"muscle of abdomen"</span>
</span><span id="__span-3-33"><a href="#__codelineno-3-33" id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="w">                   </span><span class="p">}</span>
</span><span id="__span-3-34"><a href="#__codelineno-3-34" id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-3-35"><a href="#__codelineno-3-35" id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="w">             </span><span class="p">]</span>
</span><span id="__span-3-36"><a href="#__codelineno-3-36" id="__codelineno-3-36" name="__codelineno-3-36"></a><span class="w">       </span><span class="p">}</span>
</span><span id="__span-3-37"><a href="#__codelineno-3-37" id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="p">}</span>
</span></code></pre></div>
</details>
</div>
</div>
</input></input></div>
<h3 id="preservation-and-augmentation-of-ontologies">Preservation and augmentation of ontologies<a class="headerlink" href="#preservation-and-augmentation-of-ontologies" title="Permanent link">¬∂</a></h3>
<p>One of the advantages of <strong>Beacon/Phenopackets v2</strong> is that they <strong>do not prescribe the use of specific ontologies</strong>, thus allowing us to retain the original ontologies, except to fill in missing terms in required fields.</p>
<details class="question">
<summary>Which ontologies/terminologies are supported?</summary>
<p>If the input files contain ontology tems, the <strong>ontologies will be preserved</strong> and remain intact after the conversion process, except for:</p>
<ul>
<li><em>Beacon v2 Models</em> and <em>Phenopackets v2</em>: the property <code>sex</code> is converted to <a href="https://ncithesaurus.nci.nih.gov/ncitbrowser">NCI Thesaurus</a> via database search.</li>
<li><em>OMOP CDM</em>: the properties <code>sex</code>, <code>ethnicity</code>, and <code>geographicOrigin</code> are converted to <a href="https://ncithesaurus.nci.nih.gov/ncitbrowser">NCI Thesaurus</a> via database search.</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>CSV</th>
<th>REDCap</th>
<th>CDISC-ODM</th>
<th>OMOP-CDM</th>
<th>Phenopackets v2</th>
<th>Beacon v2 Models</th>
</tr>
</thead>
<tbody>
<tr>
<td>Data mapping</td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úì</td>
</tr>
<tr>
<td>Add ontologies</td>
<td>‚úì</td>
<td>‚úì</td>
<td>‚úì</td>
<td><code>--ohdsi-db</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Database Search Feature</strong></p>
<p>For input types that do not contain ontologies, such as <code>CSV</code>, <em>REDCap</em>, and <em>CDISC-ODM</em>, we perform a <strong>database search</strong> to fetch ontologies from a variety of trusted databases. Supported databases include:</p>
<ul>
<li><a href="https://athena.ohdsi.org/search-terms/start">Athena-OHDSI</a> standardized vocabulary, which includes multiple terminologies, such as <em>SNOMED, RxNorm or LOINC</em></li>
<li><a href="https://ncithesaurus.nci.nih.gov/ncitbrowser">NCI Thesaurus</a></li>
<li><a href="https://icd.who.int/browse10">ICD-10</a> terminology</li>
<li><a href="https://www.cdisc.org/standards/terminology/controlled-terminology">CDISC</a> (Study Data Tabulation Model Terminology)</li>
<li><a href="https://www.omim.org/">OMIM</a> Online Mendelian Inheritance in Man</li>
<li><a href="https://hpo.jax.org/app">HPO</a> Human Phenotype Ontology (Note that prefixes are <code>HP:</code>, without the <code>O</code>)</li>
</ul>
</details>
<details class="hint">
<summary>About text similarity in database searches</summary>
<p><code>Convert-Pheno</code> comes with several pre-configured ontology/terminology databases. It supports three types of label-based search strategies:</p>
<hr/>
<h4 id="1-exact-default">1. <code>exact</code> (default)<a class="headerlink" href="#1-exact-default" title="Permanent link">¬∂</a></h4>
<p>Returns only <strong>exact matches</strong> for the given label string. If the label is not found exactly, no results are returned.</p>
<hr/>
<h4 id="2-mixed-use-search-mixed">2. <code>mixed</code> (use <code>--search mixed</code>)<a class="headerlink" href="#2-mixed-use-search-mixed" title="Permanent link">¬∂</a></h4>
<p><strong>Hybrid search</strong>: First tries to find an exact label match. If none is found, it performs a token-based similarity search and returns the closest matching concept based on the <strong>highest similarity score</strong>.</p>
<hr/>
<h4 id="3-fuzzy-use-search-fuzzy">3. ‚ú® <code>fuzzy</code> (use <code>--search fuzzy</code>)<a class="headerlink" href="#3-fuzzy-use-search-fuzzy" title="Permanent link">¬∂</a></h4>
<p><strong>Hybrid search with fuzzy ranking</strong>:<br/>
Like <code>mixed</code>, it starts with an exact match attempt. If that fails, it performs a <strong>weighted similarity search</strong>, where:
- <strong>90%</strong> of the score comes from token-based similarity (e.g., cosine or Dice coefficient),
- <strong>10%</strong> comes from the <strong>normalized Levenshtein similarity</strong>.</p>
<p>The concept with the highest composite score is returned.</p>
<p><strong>Note:</strong> The normalized Levenshtein similarity is computed on top of the candidate results produced by the full text search. In this approach, an initial full text search (using token-based methods) returns a set of potential matches. The fuzzy search then refines these results by applying the normalized Levenshtein distance to better handle minor typographical differences, ensuring that the final composite score reflects both overall token similarity and fine-grained character-level differences.</p>
<hr/>
<h4 id="example-search-behavior">üîç Example Search Behavior<a class="headerlink" href="#example-search-behavior" title="Permanent link">¬∂</a></h4>
<p><strong>Query:</strong> <code>Exercise pain management</code><br/>
- With <code>--search exact</code>: ‚úÖ Match found ‚Äî <strong>Exercise Pain Management</strong></p>
<p><strong>Query:</strong> <code>Brain Hemorrhage</code><br/>
- With <code>--search mixed</code>:<br/>
  - ‚ùå No exact match<br/>
  - ‚úÖ Closest match by similarity: <strong>Intraventricular Brain Hemorrhage</strong></p>
<hr/>
<h3 id="similarity-threshold">üí° Similarity Threshold<a class="headerlink" href="#similarity-threshold" title="Permanent link">¬∂</a></h3>
<p>The <code>--min-text-similarity-score</code> option sets the minimum threshold for <code>mixed</code> and <code>fuzzy</code> searches.
- Default: <code>0.8</code> (conservative)<br/>
- Lowering the threshold may increase recall but may introduce irrelevant matches.</p>
<hr/>
<h3 id="performance-note">‚ö†Ô∏è Performance Note<a class="headerlink" href="#performance-note" title="Permanent link">¬∂</a></h3>
<p>Both <code>mixed</code> and <code>fuzzy</code> modes are more computationally intensive and can produce unexpected or less interpretable matches. Use them with care, especially on large datasets.</p>
<hr/>
<h3 id="example-results-table">üß™ Example Results Table<a class="headerlink" href="#example-results-table" title="Permanent link">¬∂</a></h3>
<p>Below is an example showing how the query <code>Sudden Death Syndrome</code> performs using different search modes against the NCIt ontology:</p>
<table>
<thead>
<tr>
<th>Query</th>
<th>Search</th>
<th>NCIt match (label)</th>
<th>NCIt code</th>
<th>Cosine</th>
<th>Dice</th>
<th>Levenshtein (Normalized)</th>
<th>Composite</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sudden Death Syndrome</td>
<td>exact</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr>
<td></td>
<td>mixed</td>
<td>CDISC SDTM Sudden Death Syndrome Type Terminology</td>
<td>NCIT:C101852</td>
<td>0.65</td>
<td>0.60</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Family History of Sudden Arrythmia Death Syndrome</td>
<td>NCIT:C168019</td>
<td>0.65</td>
<td>0.60</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Family History of Sudden Infant Death Syndrome</td>
<td>NCIT:C168209</td>
<td>0.65</td>
<td>0.60</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Sudden Infant Death Syndrome</td>
<td>NCIT:C85173</td>
<td>0.86</td>
<td>0.86</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr>
<td></td>
<td>‚ú® fuzzy</td>
<td>CDISC SDTM Sudden Death Syndrome Type Terminology</td>
<td>NCIT:C101852</td>
<td>0.65</td>
<td>0.60</td>
<td>0.43</td>
<td>0.63</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Family History of Sudden Arrythmia Death Syndrome</td>
<td>NCIT:C168019</td>
<td>0.65</td>
<td>0.60</td>
<td>0.43</td>
<td>0.63</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Family History of Sudden Infant Death Syndrome</td>
<td>NCIT:C168209</td>
<td>0.65</td>
<td>0.60</td>
<td>0.46</td>
<td>0.63</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Sudden Infant Death Syndrome</td>
<td>NCIT:C85173</td>
<td>0.86</td>
<td>0.86</td>
<td>0.75</td>
<td>0.85</td>
</tr>
</tbody>
</table>
<p><strong>Interpretation:</strong> </p>
<ul>
<li>
<p>With <code>exact</code>, there are no matches.</p>
</li>
<li>
<p>With <code>mixed</code>, the best match will be <code>Sudden Infant Death Syndrome</code>.</p>
</li>
<li>
<p>With <code>fuzzy</code>, the <strong>composite score</strong> (90% token-based + 10% Levenshtein similarity) is used to rank results.<br/>
  The highest match is <code>Sudden Infant Death Syndrome</code>, with a composite score of <strong>0.85</strong>.</p>
</li>
</ul>
<hr/>
<p>‚ú® Now we introduce a typo on the query <code>Sudden Infant Deth Syndrome</code>:</p>
<table>
<thead>
<tr>
<th>Query</th>
<th>Mode</th>
<th>Candidate Label</th>
<th>Code</th>
<th>Cosine</th>
<th>Dice</th>
<th>Levenshtein (Normalized)</th>
<th>Composite</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sudden Infant Deth Syndrome</td>
<td>fuzzy</td>
<td>CDISC SDTM Sudden Death Syndrome Type Terminology</td>
<td>NCIT:C101852</td>
<td>0.38</td>
<td>0.36</td>
<td>0.33</td>
<td>0.37</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Family History of Sudden Arrythmia Death Syndrome</td>
<td>NCIT:C168019</td>
<td>0.38</td>
<td>0.36</td>
<td>0.43</td>
<td>0.38</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Family History of Sudden Infant Death Syndrome</td>
<td>NCIT:C168209</td>
<td>0.57</td>
<td>0.55</td>
<td>0.59</td>
<td>0.57</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Sudden Infant Death Syndrome</td>
<td>NCIT:C85173</td>
<td>0.75</td>
<td>0.75</td>
<td>0.96</td>
<td>0.77</td>
</tr>
</tbody>
</table>
<p>To capture the best match we would need to lower the threshold to  <code>--min-text-similarity-score 0.75</code></p>
<p>It is possible to change the weight of Levenshtein similarity via <code>--levenshtein-weight &lt;floating 0.0 - 1.0&gt;</code>.</p>
</details>
<details class="example">
<summary>Composite Similarity Score</summary>
<p>The composite similarity score is computed as a weighted sum of two measures: the token-based similarity and the normalized Levenshtein similarity.</p>
<h4 id="1-token-based-similarity">1. Token-Based Similarity<a class="headerlink" href="#1-token-based-similarity" title="Permanent link">¬∂</a></h4>
<p>This is calculated using methods like cosine or Dice similarity to measure how similar the tokens (words) of two strings are.</p>
<h4 id="2-normalized-levenshtein-similarity">2. Normalized Levenshtein Similarity<a class="headerlink" href="#2-normalized-levenshtein-similarity" title="Permanent link">¬∂</a></h4>
<p>The normalized Levenshtein similarity is defined as:</p>
<div class="arithmatex">\[
\text{NormalizedLevenshtein}(s_1, s_2) = 1 - \frac{\text{lev}(s_1, s_2)}{\max(|s_1|, |s_2|)}
\]</div>
<p>Where:
- <span class="arithmatex">\(\text{lev}(s_1, s_2)\)</span> is the Levenshtein edit distance‚Äîthe minimum number of insertions, deletions, or substitutions required to change <span class="arithmatex">\(s_1\)</span> into <span class="arithmatex">\(s_2\)</span>.
- <span class="arithmatex">\(|s_1|\)</span> and <span class="arithmatex">\(|s_2|\)</span> are the lengths of the strings <span class="arithmatex">\(s_1\)</span> and <span class="arithmatex">\(s_2\)</span>, respectively.</p>
<p>This formula produces a score between 0 and 1, with <strong>1.0</strong> meaning identical strings and <strong>0.0</strong> meaning completely different strings.</p>
<h4 id="3-composite-score-formula">3. Composite Score Formula<a class="headerlink" href="#3-composite-score-formula" title="Permanent link">¬∂</a></h4>
<p>The final composite similarity score <span class="arithmatex">\(C\)</span> is a weighted combination of the two metrics:</p>
<div class="arithmatex">\[
C(s_1, s_2) = \alpha \cdot \text{TokenSimilarity}(s_1, s_2) + \beta \cdot \text{NormalizedLevenshtein}(s_1, s_2)
\]</div>
<p>Where:
- <span class="arithmatex">\(\alpha\)</span> (or <code>token_weight</code>) is the weight assigned to the token-based similarity.
- <span class="arithmatex">\(\beta\)</span> (or <code>lev_weight</code>) is the weight assigned to the normalized Levenshtein similarity.</p>
<p>A common default is to set <span class="arithmatex">\(\alpha = 0.9\)</span> and <span class="arithmatex">\(\beta = 0.1\)</span>, emphasizing the token-based similarity. However, for short strings (4‚Äì5 words), you might consider adjusting the balance (for example, <span class="arithmatex">\(\alpha = 0.95\)</span> and <span class="arithmatex">\(\beta = 0.05\)</span>) if small typographical differences are less critical.</p>
</details>
<h2 id="step-2-conversion-to-the-final-model">Step 2: Conversion to the final model<a class="headerlink" href="#step-2-conversion-to-the-final-model" title="Permanent link">¬∂</a></h2>
<div class="admonition example">
<p class="admonition-title">Data validation</p>
<p>To ensure the integrity and validity of converted outputs, we employ <strong>external validation tools during development and in unit tests</strong>. Specifically, we used the <a href="https://github.com/CNAG-Biomedical-Informatics/beacon2-cbi-tools?tab=readme-ov-file#bff-tools-script-binbff-tools">bff-tools validate</a> for Beacon Friendly Format (BFF) and <a href="http://phenopackets.org/phenopacket-tools/stable">phenopacket-tools</a> for Phenotype Exchange Format (PXF). These validators were instrumental in ensuring converted data adhere to the respective schemas and standards; for example, conversions were validated until the output was 100% compliant with the target schema. The same validation process is applied to Beacon v2 and OMOP CDM outputs. By preserving non-mapped variables where appropriate and applying rigorous validation, we aim to mitigate information loss and maximise fidelity of the converted data.</p>
<p><strong>Important:</strong> Convert-Pheno <strong>does not validate your input data</strong>. Input validation is out of scope for the software. If fields are missing or malformed, Convert-Pheno will handle these cases internally and apply default values where appropriate, but it will not verify that your source files are complete or correct. We therefore recommend validating and cleaning source files before conversion.</p>
<p>See:</p>
<ul>
<li><a href="https://github.com/CNAG-Biomedical-Informatics/beacon2-cbi-tools?tab=readme-ov-file#bff-tools-script-binbff-tools">bff-tools validate</a></li>
<li><a href="http://phenopackets.org/phenopacket-tools/stable">phenopacket-tools</a></li>
<li><a href="https://github.com/CNAG-Biomedical-Informatics/omop-csv-validator">OMOP CSV Validator</a></li>
</ul>
</div>
<h3 id="to-phenopackets">To Phenopackets<a class="headerlink" href="#to-phenopackets" title="Permanent link">¬∂</a></h3>
<p>If the output is set to <a href="../pxf/">Phenopackets v2</a> then a second step (<code>bff2pxf</code>) is performed (see diagram above).</p>
<details class="warning">
<summary>BFF and PXF community alignment</summary>
<p>At present, we have prioritized mapping the terms that we deem most critical in facilitating <strong>basic semantic interoperability</strong>. We anticipate that Beacon v2 Models will become more aligned with Phenopackets v2, which will simplify the conversion process in future updates. We aim to refine the mappings in future iterations, with the community providing a wider range of case studies.</p>
</details>
<h3 id="to-omop-cdm">To OMOP CDM<a class="headerlink" href="#to-omop-cdm" title="Permanent link">¬∂</a></h3>
<p>If the output is set to <a href="../omop-cdm/">OMOP CDM</a> then a second step (<code>bff2omop</code>) is performed (see diagram above).</p>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      ¬© Copyright 2022-2025, Manuel Rueda, CNAG
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/mrueda" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["content.code.select", "content.code.copy", "content.tabs.link", "search.highlight", "search.share", "navigation.tracking", "navigation.sections", "toc.integrate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script src="../js/theme_overrides.js"></script>
<script src="../js/katex.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({
    startOnLoad: true
});</script></body>
</html>